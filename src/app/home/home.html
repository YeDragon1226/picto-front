<div class="announcement-container">
  <div class="announcement-wrapper">
    <div class="top-bar">
      @if (!showNewForm && !showReminderForm) {
      <h2 class="head-color">Announcements</h2>
      <input [(ngModel)]="searchTerm" placeholder="Search" class="input" />
      }
    </div>

    @if (showNewForm) {
    <form class="form-box" [formGroup]="announceForm">
      <input formControlName="title" placeholder="Title" class="input" />
      <textarea
        formControlName="message"
        placeholder="Message"
        class="textarea"
      ></textarea>

      <div [className]="'form-actions'">
        <div class="picker">
          <p>Announced On:</p>
          <input formControlName="date" type="date" class="input" />
          <p>Remind In (day/s):</p>
          <input
            (invalid)="onError('reminder')"
            formControlName="reminder"
            type="number"
            class="input"
            min="0"
            [pattern]="'^[0-9]*$'"
          />
        </div>

        <div class="input-wrapper">
          <input
            #receiver
            formControlName="employee"
            placeholder="Search Employee/s"
            type="text"
            class="input"
            (focus)="showSelect = true"
          />
          @if (showSelect) {
          <i class="close-icon fas fa-close" (click)="showSelect = false"></i>
          }
        </div>
      </div>

      @if (showSelect) { @if(added_employees.length >= 0 && added_employees[0]
      != 'everyone') {
      <div class="autocomplete">
        <div class="member" (click)="onEveryoneClick()">everyone</div>
        @for (item of employees(); track $index) {
        <div class="member" (click)="onMemberClick(item.nickname)">
          {{item.nickname}}
        </div>
        }
      </div>
      }}

      <div class="added_employees">
        @for (item of added_employees; track $index) {
        <div class="member">
          {{item}}
          <i class="fas fa-times" (click)="onAddedMemberClick(item)"></i>
        </div>
        }
      </div>

      <div class="form-footer">
        <div class="pin-toggle">
          <input type="checkbox" id="pin" formControlName="pinned" />
          <label for="pin">Pin this Announcement</label>
        </div>
        <div class="btn">
          <button class="post-btn" (click)="onSubmit()">
            <i class="fas fa-paper-plane"></i>
          </button>
          <button class="cancel-btn" (click)="showNewForm = false">
            <i class="fas fa-ban"></i>
          </button>
        </div>
      </div>
    </form>
    } @else if (showReminderForm) {
    <div class="reminder-card">
      <div class="header">
        <h3>Reminders</h3>
        <i class="fas fa-close" (click)="showReminderForm = false"></i>
      </div>
      <div class="reminder-list">
        @for (a of data.announcements; track $index) {
          <div class="card" [ngClass]="'receiver-' + sanitizeReceiver(a.receiver)">
          <div class="card-header">
            <h3>
              {{ a.title }} @if (a.pinned) {
              <span title="Pinned">ðŸ“Œ</span>
              }
            </h3>
          </div>
          <p>{{ a.message }}</p>
          <small>{{ a.date }} â€” <i><strong> {{ a.receiver }}</strong></i></small>

            <div class="action-container">
            <p>Remind At : <strong>{{computedReminder(a.date, $index)}}</strong></p>
            <form action="" [formGroup]="reminderForm">
              <input
                formControlName="reminder"
                type="number"
                value="{{a.reminder}}"
                min="0"
              />
            </form>
            <button class="" (click)="saveReminder(a, $index)"><i class="fas fa-save"></i></button>
          </div>
        </div>
        }
      </div>
    </div>
    } @else {

    <div class="widget">
      <span class="label">Today :</span>
      <span class="value">{{ today | date }}</span>
    </div>

    <div class="card-container">
    @for (a of filteredAnnouncements; track $index) {
      <div class="card" [ngClass]="'receiver-' + sanitizeReceiver(a.receiver)">
        <div class="card-header">
          <h3>
            {{ a.title }} @if (a.pinned) {
              <span title="Pinned">ðŸ“Œ</span>
            }
          </h3>
        </div>
        <p>{{ a.message }}</p>
        <small>{{ a.date }} â€” <i><strong> {{ a.receiver }}</strong></i></small>
      </div>
    }


      <div class="card add-announcement-card" (click)="showNewForm = true">
        <div class="add-icon">+</div>
        <div class="add-label">Add Announcement</div>
      </div>
    </div>

    <div class="reminder-card">
      <div class="header">
        <h3>Reminders</h3>
        <i (click)="showReminderForm = true" class="fas fa-plus"></i>
      </div>
      <div class="reminder-list">
        @for (a of filteredReminders; track $index) {
          <div class="card" [ngClass]="'receiver-' + sanitizeReceiver(a.receiver)">
            <div class="card-header">
              <h3>
                {{ a.title }}
                @if (a.pinned) {
                  <span title="Pinned">ðŸ“Œ</span>
                }
              </h3>
            </div>
            <p>{{ a.message }}</p>
            <small>{{ a.date }} â€” <i><strong> {{ a.receiver }}</strong></i></small>
          </div>
        }
      </div>
    </div>


    <div class="portfolio-sections">
      <div class="portfolio-section">
        <div class="header">
          <h3>Incoming</h3>

          <input
            type="file"
            id="incomingFile"
            (change)="onImageInSelected($event)"
            accept="image/*"
            hidden
          />
          <label for="incomingFile">
            <i class="fas fa-upload"></i>
          </label>
        </div>

        <ul class="portfolio-thumbnails">
          @if (imageInPreview) {
          <li>
            <img [src]="imageInPreview" />
            <div class="overlay">
              <i class="fas fa-eye"></i>
              <a [href]="imageInPreview" target="_blank">View</a>
            </div>
          </li>
          }
        </ul>
      </div>

      <div class="portfolio-section">
        <div class="header">
          <h3>Outgoing</h3>
          <input
            type="file"
            id="outcomingFile"
            (change)="onImageOutSelected($event)"
            accept="image/*"
            hidden
          />
          <label for="outcomingFile">
            <i class="fas fa-upload"></i>
          </label>
        </div>

        <ul class="portfolio-thumbnails">
          @if (imageOutPreview) {
          <li>
            <img [src]="imageOutPreview" />
            <div class="overlay">
              <i class="fas fa-eye"></i>
              <a [href]="imageOutPreview" target="_blank">View</a>
            </div>
          </li>
          }
        </ul>
      </div>
    </div>

    }
  </div>
</div>
